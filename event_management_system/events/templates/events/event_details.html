{% extends 'events/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="card shadow-lg border-0">
        <div class="card-body">
            <h1 class="card-title display-5 fw-bold">{{ event.title }}</h1>
            <h6 class="text-muted mb-3">Hosted on {{ event.date|date:"F d, Y" }} at {{ event.time|time:"g:i A" }}</h6>
            <p class="card-text">{{ event.description }}</p>
            <p class="mb-2"><strong>Location:</strong> {{ event.location }}</p>

            <div class="d-flex flex-wrap gap-2 mt-4">
                {% if user.is_staff %}
                    <a href="{% url 'edit_event' event.id %}" class="btn btn-outline-warning">Edit</a>
                    <a href="{% url 'delete_event' event.id %}" class="btn btn-outline-danger">Delete</a>
                {% endif %}
                {% if user.is_authenticated %}
                    {% if user in event.registered_users.all %}
                        <form action="{% url 'unregister_event' event.id %}" method="POST" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">Unregister</button>
                        </form>
                    {% else %}
                        <form action="{% url 'register_for_event' event.id %}" method="POST" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success">Register for this Event</button>
                        </form>
                    {% endif %}
                {% else %}
                    <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary">Login to Register</a>
                {% endif %}
                <a href="{% url 'event_list' %}" class="btn btn-secondary">Back to Events</a>
            </div>
        </div>
    </div>

    {% if user.is_authenticated and user in event.registered_users.all %}
        <div class="mt-5">
            <h4 class="fw-semibold">Registered Attendees:</h4>
            <ul class="list-group list-group-flush mt-3">
                {% for attendee in event.registered_users.all %}
                    <li class="list-group-item">{{ attendee.username }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>
{% endblock %}